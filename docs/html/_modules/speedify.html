
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>speedify &#8212; Speedify for Python  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for speedify</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># Uses Python 3.7</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="k">import</span> <span class="n">use_shell</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: speedify</span>
<span class="sd">   :synopsis: Contains speedify cli wrapper functions</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="State"><a class="viewcode-back" href="../speedify.html#speedify.State">[docs]</a><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum of speedify states.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LOGGED_OUT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LOGGING_IN</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">LOGGED_IN</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">AUTO_CONNECTING</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">CONNECTING</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">DISCONNECTING</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">CONNECTED</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">OVERLIMIT</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="mi">8</span></div>

<div class="viewcode-block" id="Priority"><a class="viewcode-back" href="../speedify.html#speedify.Priority">[docs]</a><span class="k">class</span> <span class="nc">Priority</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum of speedify connection priorities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ALWAYS</span><span class="o">=</span><span class="s1">&#39;always&#39;</span>
    <span class="n">BACKUP</span><span class="o">=</span><span class="s1">&#39;backup&#39;</span>
    <span class="n">SECONDARY</span><span class="o">=</span><span class="s1">&#39;secondary&#39;</span>
    <span class="n">NEVER</span><span class="o">=</span><span class="s1">&#39;never&#39;</span></div>

<div class="viewcode-block" id="SpeedifyError"><a class="viewcode-back" href="../speedify.html#speedify.SpeedifyError">[docs]</a><span class="k">class</span> <span class="nc">SpeedifyError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic error thrown by library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span></div>

<div class="viewcode-block" id="SpeedifyAPIError"><a class="viewcode-back" href="../speedify.html#speedify.SpeedifyAPIError">[docs]</a><span class="k">class</span> <span class="nc">SpeedifyAPIError</span><span class="p">(</span><span class="n">SpeedifyError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error thrown if speedify gave a bad json response.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span> <span class="n">error_message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_code</span> <span class="o">=</span> <span class="n">error_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">=</span> <span class="n">error_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">error_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span><span class="n">error_message</span></div>

<span class="n">_cli_path</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="set_cli"><a class="viewcode-back" href="../speedify.html#speedify.set_cli">[docs]</a><span class="k">def</span> <span class="nf">set_cli</span><span class="p">(</span><span class="n">new_cli_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change the path to the cli after importing the module.</span>
<span class="sd">    The path defaults to the cli&#39;s default install location.</span>

<span class="sd">    :param new_cli_path:  Full path to speedify_cli.</span>
<span class="sd">    :type new_cli_path: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_cli_path</span>
    <span class="n">_cli_path</span> <span class="o">=</span> <span class="n">new_cli_path</span></div>

<div class="viewcode-block" id="get_cli"><a class="viewcode-back" href="../speedify.html#speedify.get_cli">[docs]</a><span class="k">def</span> <span class="nf">get_cli</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :returns:  str -- The full path to the speedify cli.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">global</span> <span class="n">_cli_path</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">_cli_path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>  <span class="p">(</span><span class="n">_cli_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span>
        <span class="n">_cli_path</span> <span class="o">=</span> <span class="n">_find_cli</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_cli_path</span></div>

<span class="k">def</span> <span class="nf">find_state_for_string</span><span class="p">(</span><span class="n">mystate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">State</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mystate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

<span class="k">def</span> <span class="nf">exception_wrapper</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">except</span> <span class="n">SpeedifyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">argument</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">err</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="c1"># Functions for controlling Speedify State</span>

<div class="viewcode-block" id="connect"><a class="viewcode-back" href="../speedify.html#speedify.connect">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    connect(server=&quot;&quot;)</span>
<span class="sd">    Tell Speedify to connect. Returns serverInformation if success, raises Speedify if unsuccessful.</span>
<span class="sd">    See show_servers() for the list of servers available.</span>

<span class="sd">    :param server: Server to connect to.</span>
<span class="sd">    :type server: str</span>
<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;connect&#39;</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">server</span><span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">server</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">pieces</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;connecting to server = &#39;</span> <span class="o">+</span> <span class="n">server</span><span class="p">)</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="connect_closest"><a class="viewcode-back" href="../speedify.html#speedify.connect_closest">[docs]</a><span class="k">def</span> <span class="nf">connect_closest</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Connects to the closest server</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;closest&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="connect_public"><a class="viewcode-back" href="../speedify.html#speedify.connect_public">[docs]</a><span class="k">def</span> <span class="nf">connect_public</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Connects to the closest public server</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;public&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="connect_private"><a class="viewcode-back" href="../speedify.html#speedify.connect_private">[docs]</a><span class="k">def</span> <span class="nf">connect_private</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Connects to the closest private server</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;private&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="connect_p2p"><a class="viewcode-back" href="../speedify.html#speedify.connect_p2p">[docs]</a><span class="k">def</span> <span class="nf">connect_p2p</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Connects to a server that allows p2p traffic</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;p2p&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="connect_country"><a class="viewcode-back" href="../speedify.html#speedify.connect_country">[docs]</a><span class="k">def</span> <span class="nf">connect_country</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="s2">&quot;us&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Connects to a server via the 2 letter country code</span>
<span class="sd">    See show_servers() for the list of servers available.</span>

<span class="sd">    :param country: 2 letter country code.</span>
<span class="sd">    :type country: str</span>
<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">country</span><span class="p">)</span></div>
<div class="viewcode-block" id="connect_last"><a class="viewcode-back" href="../speedify.html#speedify.connect_last">[docs]</a><span class="k">def</span> <span class="nf">connect_last</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Connects to the last server</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;connect&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;last&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="disconnect"><a class="viewcode-back" href="../speedify.html#speedify.disconnect">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Disconnect failed&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">disconnect</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    disconnect()</span>
<span class="sd">    Disconnects. Waits for disconnect to complete</span>

<span class="sd">    :returns: bool -- TRUE if disconnect succeeded</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s2">&quot;disconnect&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="connectmethod"><a class="viewcode-back" href="../speedify.html#speedify.connectmethod">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set connect method&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">connectmethod</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s2">&quot;us&quot;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    connectmethod(method, country=&quot;us&quot;, city=None, num=None)</span>
<span class="sd">    Sets the default connectmethod of closest,p2p,private or country (in which case country is required)</span>

<span class="sd">    :param method: The connect method.</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param country: 2 letter country code.</span>
<span class="sd">    :type country: str</span>
<span class="sd">    :param city: The city the server is located.</span>
<span class="sd">    :type city: str</span>
<span class="sd">    :param num: The server number.</span>
<span class="sd">    :type num: int</span>
<span class="sd">    :returns:  dict -- :ref:`JSON connectmethod &lt;connectmethod&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;connectmethod&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;dedicated&quot;</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;private&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;country&quot;</span><span class="p">):</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">city</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="login"><a class="viewcode-back" href="../speedify.html#speedify.login">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to login&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    login(user, password)</span>
<span class="sd">    Login.  Returns a State.  returns the state if succesful</span>

<span class="sd">    :param user: username</span>
<span class="sd">    :type user: str</span>
<span class="sd">    :param password: password</span>
<span class="sd">    :type password: str</span>
<span class="sd">    :returns:  speedify.State -- The speedify state enum.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">]</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">find_state_for_string</span><span class="p">(</span><span class="n">resultjson</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="logout"><a class="viewcode-back" href="../speedify.html#speedify.logout">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to logout&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    logout()</span>
<span class="sd">    logout.  returns the state, desc=LOGGED_OUT is a success</span>

<span class="sd">    :returns:  speedify.State -- The speedify state enum.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">jret</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;logout&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">find_state_for_string</span><span class="p">(</span><span class="n">jret</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span></div>

<span class="c1">### Getter functions ###</span>

<div class="viewcode-block" id="show_servers"><a class="viewcode-back" href="../speedify.html#speedify.show_servers">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get server list&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_servers</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_servers()</span>
<span class="sd">    Returns all the servers, public and private</span>

<span class="sd">    :returns:  dict -- :ref:`JSON server list &lt;show-servers&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;servers&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_privacy"><a class="viewcode-back" href="../speedify.html#speedify.show_privacy">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get privacy&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_privacy</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_privacy()</span>
<span class="sd">    Returns privacy settings</span>

<span class="sd">    :returns:  dict -- dict -- :ref:`JSON privacy &lt;show-privacy&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;privacy&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_settings"><a class="viewcode-back" href="../speedify.html#speedify.show_settings">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get settings&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_settings</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_settings()</span>
<span class="sd">    Returns current settings</span>

<span class="sd">    :returns:  dict -- dict -- :ref:`JSON settings &lt;show-settings&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;settings&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_adapters"><a class="viewcode-back" href="../speedify.html#speedify.show_adapters">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get adapters&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_adapters</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_adapters()</span>
<span class="sd">    Returns current adapters</span>

<span class="sd">    :returns:  dict -- dict -- :ref:`JSON list of adapters &lt;show-adapters&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;adapters&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_currentserver"><a class="viewcode-back" href="../speedify.html#speedify.show_currentserver">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get current server&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_currentserver</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_currentserver()</span>
<span class="sd">    Returns current server</span>

<span class="sd">    :returns:  dict -- :ref:`JSON currentserver &lt;show-currentserver&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;currentserver&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_user"><a class="viewcode-back" href="../speedify.html#speedify.show_user">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get current user&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_user</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_user()</span>
<span class="sd">    Returns current user</span>

<span class="sd">    :returns:  dict -- :ref:`JSON response &lt;show-user&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_connectmethod"><a class="viewcode-back" href="../speedify.html#speedify.show_connectmethod">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to show connect method&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_connectmethod</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_connectmethod()</span>
<span class="sd">    Returns the connectmethod related settings</span>

<span class="sd">    :returns:  :ref:`JSON response &lt;show-connectmethod&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;connectmethod&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_state"><a class="viewcode-back" href="../speedify.html#speedify.show_state">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;getting state&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_state</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_state()</span>
<span class="sd">    Returns the current state of Speedify (CONNECTED, CONNECTING, etc.)</span>

<span class="sd">    :returns:  speedify.State -- The speedify state enum.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">jret</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">find_state_for_string</span><span class="p">(</span><span class="n">jret</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="show_version"><a class="viewcode-back" href="../speedify.html#speedify.show_version">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to get version&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_version</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    show_version()</span>
<span class="sd">    Returns speedify version</span>

<span class="sd">    :returns:  dict -- :ref:`JSON version &lt;version&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span>  <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;version&#39;</span><span class="p">])</span></div>

<span class="c1">### Setter functions ###</span>
<div class="viewcode-block" id="adapter_priority"><a class="viewcode-back" href="../speedify.html#speedify.adapter_priority">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set adapter priority&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adapter_priority</span><span class="p">(</span><span class="n">adapterID</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">Priority</span><span class="o">.</span><span class="n">ALWAYS</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adapter_priority(adapterID, priority=Priority.ALWAYS)</span>
<span class="sd">    Sets the priority on the adapter whose adapterID is provided (show_adapters is where you find the adapterIDs)</span>

<span class="sd">    :param adapterID: The interface adapterID</span>
<span class="sd">    :type adapterID: str</span>
<span class="sd">    :param priority: The speedify priority</span>
<span class="sd">    :type priority: speedify.Priority</span>
<span class="sd">    :returns:  dict -- :ref:`JSON adapter response &lt;adapter-ratelimit&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adapter&#39;</span><span class="p">,</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">adapterID</span><span class="p">))</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">priority</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="adapter_ratelimit"><a class="viewcode-back" href="../speedify.html#speedify.adapter_ratelimit">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set adapter ratelimit&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adapter_ratelimit</span><span class="p">(</span><span class="n">adapterID</span><span class="p">,</span> <span class="n">ratelimit</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adapter_ratelimit(adapterID, ratelimit=0)</span>
<span class="sd">    Sets the ratelimit in bps on the adapter whose adapterID is provided</span>
<span class="sd">    (show_adapters is where you find the adapterIDs)</span>

<span class="sd">    :param adapterID: The interface adapterID</span>
<span class="sd">    :type adapterID: str</span>
<span class="sd">    :param ratelimit: The ratelimit in bps</span>
<span class="sd">    :type ratelimit: int</span>
<span class="sd">    :returns:  dict -- :ref:`JSON adapter response &lt;adapter-datalimit-daily&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adapter&#39;</span><span class="p">,</span><span class="s2">&quot;ratelimit&quot;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">adapterID</span><span class="p">))</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">ratelimit</span><span class="p">)))</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="adapter_datalimit_daily"><a class="viewcode-back" href="../speedify.html#speedify.adapter_datalimit_daily">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set adapter daily limit&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adapter_datalimit_daily</span><span class="p">(</span> <span class="n">adapterID</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adapter_datalimit_daily( adapterID, limit=0)</span>
<span class="sd">    Sets the daily usage limit in bytes on the adapter whose adapterID is provided</span>
<span class="sd">    (show_adapters is where you find the adapterIDs)</span>

<span class="sd">    :param adapterID: The interface adapterID</span>
<span class="sd">    :type adapterID: str</span>
<span class="sd">    :param limit: The daily usage limit, in bytes</span>
<span class="sd">    :type limit: int</span>
<span class="sd">    :returns:  dict -- :ref:`JSON adapter response &lt;adapter-datalimit-daily&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adapter&#39;</span><span class="p">,</span><span class="s2">&quot;datalimit&quot;</span><span class="p">,</span> <span class="s2">&quot;daily&quot;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">adapterID</span><span class="p">))</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)))</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="adapter_datalimit_monthly"><a class="viewcode-back" href="../speedify.html#speedify.adapter_datalimit_monthly">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set adapter monthly limit&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adapter_datalimit_monthly</span><span class="p">(</span><span class="n">adapterID</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">reset_day</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adapter_datalimit_monthly(adapterID, limit=0, reset_day=0)</span>
<span class="sd">    Sets the monthly usage limit in bytes on the adapter whose adapterID is provided</span>
<span class="sd">    (show_adapters is where you find the adapterIDs)</span>

<span class="sd">    :param adapterID: The interface adapterID</span>
<span class="sd">    :type adapterID: str</span>
<span class="sd">    :param limit: The monthly usage limit, in bytes</span>
<span class="sd">    :type limit: int</span>
<span class="sd">    :param reset_day: The day of the month to reset monthly usage (0-31)</span>
<span class="sd">    :type reset_Day: int</span>
<span class="sd">    :returns:  dict -- :ref:`JSON adapter response &lt;adapter-datalimit-monthly&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adapter&#39;</span><span class="p">,</span> <span class="s2">&quot;datalimit&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly&quot;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">adapterID</span><span class="p">))</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)))</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reset_day</span><span class="p">))</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="adapter_resetusage"><a class="viewcode-back" href="../speedify.html#speedify.adapter_resetusage">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to reset adapter usage&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adapter_resetusage</span><span class="p">(</span><span class="n">adapterID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adapter_resetusage(adapterID)</span>
<span class="sd">    Resets all the stats on this adapter back to 0.  Starts both daily and monthly limits over, if set.</span>

<span class="sd">    :param adapterID: The interface adapterID</span>
<span class="sd">    :type adapterID: str</span>
<span class="sd">    :returns:  dict -- :ref:`JSON adapter response &lt;adapter-resetusage&gt;` from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adapter&#39;</span><span class="p">,</span> <span class="s2">&quot;resetusage&quot;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">adapterID</span><span class="p">))</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="ports"><a class="viewcode-back" href="../speedify.html#speedify.ports">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set ports&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">ports</span><span class="p">(</span><span class="n">tcpports</span><span class="o">=</span><span class="p">[],</span> <span class="n">udpports</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    ports(tcpports=[], udpports=[])</span>
<span class="sd">    sets port forwarding. call with no arguments to unset all port forwarding</span>

<span class="sd">    :param tcpports: List of tcp ports to forward on</span>
<span class="sd">    :type tcpport: list</span>
<span class="sd">    :param udpports: List of udp ports to forward on</span>
<span class="sd">    :type udpport: list</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;ports&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ports&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tcpports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">tcpports</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/tcp&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">udpports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">udpports</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/udp&quot;</span><span class="p">)</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="mode"><a class="viewcode-back" href="../speedify.html#speedify.mode">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to change modes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;speed&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    mode(mode=&quot;speed&quot;)</span>
<span class="sd">    Set &#39;redundant&#39; or &#39;speed&#39; operation modes</span>

<span class="sd">    :param mode: &quot;redundant&quot; or &quot;speed&quot;</span>
<span class="sd">    :type mode: str</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;mode&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">]</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="encryption"><a class="viewcode-back" href="../speedify.html#speedify.encryption">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set encryption&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">encryption</span><span class="p">(</span><span class="n">encrypt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    encryption(encrypt=True)</span>
<span class="sd">    Sets encryption on or off.</span>

<span class="sd">    :param encrypt: Encrypted on or off</span>
<span class="sd">    :type encrypt: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;encryption&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;encryption&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">encrypt</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">encrypt</span> <span class="o">==</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">encrypt</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="jumbo"><a class="viewcode-back" href="../speedify.html#speedify.jumbo">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set jumbo&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">jumbo</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    jumbo(mode=True)</span>
<span class="sd">    Sets jumbo MTU mode on or off.</span>

<span class="sd">    :param mode: Jumbo MTU on or off</span>
<span class="sd">    :type mode: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;jumbo&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jumbo&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#probably invalid, but we&#39;ll let speedify tell us THAT</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="packetaggregation"><a class="viewcode-back" href="../speedify.html#speedify.packetaggregation">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set packetaggregation&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">packetaggregation</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    packetaggregation(mode=True)</span>
<span class="sd">    Sets packetaggregation mode on or off.</span>

<span class="sd">    :param mode: packetaggregation on or off</span>
<span class="sd">    :type mode: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;packetaggr&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;packetaggr&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#probably invalid, but we&#39;ll let speedify tell us THAT</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="killswitch"><a class="viewcode-back" href="../speedify.html#speedify.killswitch">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set killswitch&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">killswitch</span><span class="p">(</span><span class="n">killswitch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    killswitch(killswitch=False)</span>
<span class="sd">    sets killswitch on or off. (Windows only)</span>

<span class="sd">    :param killswitch: killswitch on or off</span>
<span class="sd">    :type killswitch: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON privacy response &lt;privacy-killswitch&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;privacy&#39;</span><span class="p">,</span><span class="s1">&#39;killswitch&#39;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">killswitch</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="overflow"><a class="viewcode-back" href="../speedify.html#speedify.overflow">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set overflow&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">overflow</span><span class="p">(</span><span class="n">speed_in_mbps</span><span class="o">=</span><span class="mf">30.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    overflow(speed_in_mbps=30.0)</span>
<span class="sd">    sets overflow threshold.</span>

<span class="sd">    :param speed_in_mbps: Overflow threshold in mbps</span>
<span class="sd">    :type speed_in_mbps: float</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;overflow&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;overflow&#39;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">speed_in_mbps</span><span class="p">))</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="dnsleak"><a class="viewcode-back" href="../speedify.html#speedify.dnsleak">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set dnsleak&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dnsleak</span><span class="p">(</span><span class="n">leak</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    dnsleak(leak=False)</span>
<span class="sd">    sets dnsleak on or off. (Windows only)</span>

<span class="sd">    :param dnsleak: dnsleak on or off</span>
<span class="sd">    :type dnsleak: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON privacy response &lt;privacy-dnsleak&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;privacy&#39;</span><span class="p">,</span><span class="s1">&#39;dnsleak&#39;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">leak</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="crashreports"><a class="viewcode-back" href="../speedify.html#speedify.crashreports">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set crashreports&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">crashreports</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    crashreports(report=True)</span>
<span class="sd">    sets crashreports on or off.</span>

<span class="sd">    :param report: crashreports on or off</span>
<span class="sd">    :type dnsleak: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON privacy response &lt;privacy-crashreports&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;privacy&#39;</span><span class="p">,</span><span class="s1">&#39;crashreports&#39;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">report</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="startupconnect"><a class="viewcode-back" href="../speedify.html#speedify.startupconnect">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set startupconnect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">startupconnect</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    startupconnect(connect=True)</span>
<span class="sd">    sets whether to automatically connect on login.</span>

<span class="sd">    :param connect: Sets connect on startup on/off</span>
<span class="sd">    :type connect: bool</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;startupconnect&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;startupconnect&#39;</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">connect</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="speedtest"><a class="viewcode-back" href="../speedify.html#speedify.speedtest">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to run speedtest&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speedtest</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    speedtest()</span>
<span class="sd">    Returns runs speed test returns final results. Will take around 30 seconds.</span>

<span class="sd">    :returns:  dict -- :ref:`JSON speedtest &lt;speedtest&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">jret</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">([</span><span class="s1">&#39;speedtest&#39;</span><span class="p">],</span> <span class="n">cmdtimeout</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jret</span></div>

<div class="viewcode-block" id="transport"><a class="viewcode-back" href="../speedify.html#speedify.transport">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed to set transport&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transport</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    transport(transport=&#39;auto&#39;)</span>
<span class="sd">    Sets the transport mode (auto/tcp/udp).</span>

<span class="sd">    :param transport: Sets the transport</span>
<span class="sd">    :type transport: str</span>
<span class="sd">    :returns:  dict -- :ref:`JSON settings &lt;transport&gt;` from speedify</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">,</span><span class="n">transport</span><span class="p">]</span>
    <span class="n">resultjson</span> <span class="o">=</span> <span class="n">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultjson</span></div>

<div class="viewcode-block" id="stats"><a class="viewcode-back" href="../speedify.html#speedify.stats">[docs]</a><span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;Failed getting stats&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    stats(time=1)</span>
<span class="sd">    calls stats returns a list of all the parsed json objects it gets back</span>

<span class="sd">    :param time: How long to run the stats command.</span>
<span class="sd">    :type time: int</span>
<span class="sd">    :returns:  list -- list JSON stat responses from speedify.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;stats cannot be run with 0, would never return&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;Stats cannot be run with 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># fix for bug where passing in 1 returns nothing.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">class</span> <span class="nc">list_callback</span><span class="p">():</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="n">list_callback</span> <span class="o">=</span> <span class="n">list_callback</span><span class="p">()</span>
    <span class="n">stats_callback</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">list_callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">list_callback</span><span class="o">.</span><span class="n">result_list</span></div>

<div class="viewcode-block" id="stats_callback"><a class="viewcode-back" href="../speedify.html#speedify.stats_callback">[docs]</a><span class="k">def</span> <span class="nf">stats_callback</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    stats_callback(time, callback)</span>
<span class="sd">    calls stats, and callback supplied function with each line of output. 0 is forever</span>

<span class="sd">    :param time: How long to run the stats command.</span>
<span class="sd">    :type time: int</span>
<span class="sd">    :param callback: Callback function</span>
<span class="sd">    :type callback: function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)]</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_cli</span><span class="p">()]</span> <span class="o">+</span> <span class="n">args</span>

    <span class="n">_run_long_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div>

<span class="c1">### Internal functions ###</span>
<span class="k">def</span> <span class="nf">_run_speedify_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cmdtimeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="s2">&quot;passes list of args to speedify command line returns the objects pulled from the json&quot;</span>
    <span class="n">resultstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_cli</span><span class="p">()]</span> <span class="o">+</span> <span class="n">args</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">shell</span><span class="o">=</span><span class="n">use_shell</span><span class="p">(),</span><span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">cmdtimeout</span><span class="p">)</span>
        <span class="n">resultstr</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">resultstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">reclen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reclen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;command &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; had NO records&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;No output from command &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Command timed out&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;Command timed out: &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Running cmd, bad json: (&#39;</span> <span class="o">+</span> <span class="n">resultstr</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;Invalid output from CLI&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">cpe</span><span class="p">:</span>
        <span class="c1">#TODO: errors can be json now</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">cpe</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="n">cpe</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Usage :&quot;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">):</span>
            <span class="c1"># usage message our command make no sesne</span>
            <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;Unknown command&quot;</span><span class="p">)</span>
        <span class="n">newerror</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">&quot;errorCode&quot;</span> <span class="ow">in</span> <span class="n">job</span><span class="p">):</span>
                <span class="c1">#json error! came from the speedify daemon</span>
                <span class="n">newerror</span> <span class="o">=</span> <span class="n">SpeedifyAPIError</span><span class="p">(</span><span class="n">job</span><span class="p">[</span><span class="s2">&quot;errorCode&quot;</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="s2">&quot;errorType&quot;</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="s2">&quot;errorMessage&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1">#not json</span>
            <span class="k">pass</span>
        <span class="k">if</span><span class="p">(</span><span class="n">newerror</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">newerror</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># treat the plain text as an error, common for valid command, with invalud arguments</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;runSpeedifyCmd CPE : &quot;</span> <span class="o">+</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">out</span><span class="p">)</span>

<span class="c1"># CALLBACK VERSIONS</span>
<span class="c1"># The normal _run_speedify_cmd runs the command and waits for the final output.</span>
<span class="c1"># these versions keep running, calling you back as json objects are emitted. useful</span>
<span class="c1"># for stats and for a verbose speedtest, otherwise, stick with the non-callback versions</span>
<span class="nd">@exception_wrapper</span><span class="p">(</span><span class="s2">&quot;SpeedifyError in longRunCommand&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_run_long_command</span><span class="p">(</span><span class="n">cmdarray</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="s2">&quot;callback is a function you provide, passed parsed json objects&quot;</span>
    <span class="n">outputbuffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">with</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdarray</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span> <span class="k">as</span> <span class="n">proc</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="p">:</span>
                <span class="n">outputbuffer</span><span class="o">+=</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outputbuffer</span><span class="p">:</span>
                    <span class="n">_do_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span><span class="n">outputbuffer</span><span class="p">)</span>
                    <span class="n">outputbuffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputbuffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">outputbuffer</span><span class="p">:</span>
        <span class="n">_do_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span><span class="n">outputbuffer</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_do_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="s2">&quot;parsing string as json, calls callback function with result&quot;</span>
    <span class="n">jsonret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="n">jsonret</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SpeedifyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;problem parsing json: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">jsonret</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="n">jsonret</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SpeedifyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;problem callback: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="c1"># Default cli search locations</span>
<span class="k">def</span> <span class="nf">_find_cli</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Finds the path for the CLI&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;SPEEDIFY_CLI&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="p">:</span>
        <span class="n">possible</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SPEEDIFY_CLI&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">possible</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">possible</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using cli from SPEEDIFY_CLI of (&quot;</span> <span class="o">+</span> <span class="n">possible</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">possible</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;SPEEDIFY_CLI specified a nonexistant path to cli: </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span><span class="n">possible</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">possible_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/Applications/Speedify.app/Contents/Resources/speedify_cli&quot;</span><span class="p">,</span>
                      <span class="s1">&#39;c://program files (x86)//speedify//speedify_cli.exe&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;c://program files//speedify//speedify_cli.exe&#39;</span><span class="p">,</span>
                      <span class="s2">&quot;/usr/share/speedify/speedify_cli&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">possible_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pp</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using cli of (&quot;</span> <span class="o">+</span> <span class="n">pp</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">pp</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find speedify_cli!&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">SpeedifyError</span><span class="p">(</span><span class="s2">&quot;Speedify CLI not found&quot;</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Speedify for Python</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Speedify CLI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../speedify.html">speedify</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speedifysettings.html">speedifysettings</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Connectify.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>